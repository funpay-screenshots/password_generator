<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Generator</title>

<style>
:root {
    --bg: #f5f5f7;
    --card: #ffffff;
    --text: #111;
    --muted: #f0f0f3;
    --border: #ddd;
    --button: #000;
    --button-text: #fff;
}

.dark {
    --bg: #0f1115;
    --card: #1a1d23;
    --text: #f5f5f7;
    --muted: #2a2f38;
    --border: #333;
    --button: #ffffff;
    --button-text: #000;
}

body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: var(--bg);
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    transition: 0.25s ease;
}

.card {
    position: relative;
    background: var(--card);
    padding: 40px;
    border-radius: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    width: 360px;
    text-align: center;
    transition: 0.25s ease;
}

.theme-toggle {
    position: absolute;
    top: 18px;
    right: 18px;
    background: none;
    border: none;
    cursor: pointer;
}

h1 {
    margin-bottom: 24px;
    font-size: 20px;
    font-weight: 600;
    color: var(--text);
}

input[type="number"] {
    width: 55px;
    padding: 8px;
    border-radius: 12px;
    border: 1px solid var(--border);
    text-align: center;
    font-size: 15px;
    background: var(--card);
    color: var(--text);
}

.length-label {
    color: var(--text);
}

.password-container {
    position: relative;
    margin-top: 20px;
    width: calc(100% / 1.5);
    margin-left: auto;
    margin-right: auto;
}

.password {
    font-size: 18px;
    background: var(--muted);
    padding: 14px 50px 14px 14px;
    border-radius: 16px;
    word-break: break-all;
    user-select: all;
    color: var(--text);
    min-height: 24px;
    display: flex;
    align-items: center;
}

.copy-btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    border: none;
    background: var(--card);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: 0.2s ease;
}

.copy-btn:hover {
    transform: translateY(-50%) scale(1.08);
}

button.generate {
    margin-top: 20px;
    padding: 12px 20px;
    border: none;
    border-radius: 20px;
    font-size: 15px;
    cursor: pointer;
    background: var(--button);
    color: var(--button-text);
    transition: 0.2s;
}

button.generate:hover {
    opacity: 0.85;
}

svg {
    width: 18px;
    height: 18px;
    fill: var(--text);
}
</style>
</head>

<body class="dark">

<div class="card">
    <button class="theme-toggle" onclick="toggleTheme()">
        <svg id="themeIcon" viewBox="0 0 24 24"></svg>
    </button>

    <h1>Генератор паролей</h1>

    <div>
        <span class="length-label">Длина:</span>
        <input type="number" id="length" value="10" min="6" max="64">
    </div>

    <div class="password-container">
        <div class="password" id="result"></div>
        <button class="copy-btn" onclick="copyPassword()">
            <svg id="copyIcon" viewBox="0 0 24 24">
                <path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/>
            </svg>
        </button>
    </div>

    <button class="generate" onclick="generatePassword()">Сгенерировать</button>
</div>

<script>
function generatePassword() {
    const lengthInput = document.getElementById("length");
    let length = parseInt(lengthInput.value);
    if (length < 6) length = 6;

    const upper = "ABCDEFGHKNOPQRSTUVWXYZ";
    const lower = "abcdefghkmnopqrstuvwxyz";
    const digits = "0123456789";
    const specials = "& #%$@?".replace(" ", "");
    const allMiddle = upper + lower + digits + specials;

    function randomChar(set) {
        return set[Math.floor(Math.random() * set.length)];
    }

    function isValid(password) {
        if (!/[A-Z]/.test(password)) return false;
        if (!/[a-z]/.test(password)) return false;
        if (!/[0-9]/.test(password)) return false;
        if (!/[&#%$@?]/.test(password)) return false;

        let upperCount = (password.match(/[A-Z]/g) || []).length;
        if (upperCount > Math.floor(length * 2/3)) return false;

        for (let i = 1; i < password.length; i++) {
            if (password[i] === password[i-1]) return false;
        }
        return true;
    }

    let password = "";

    do {
        let chars = [];
        chars.push(randomChar(upper));

        while (chars.length < length - 1) {
            let next = randomChar(allMiddle);
            if (next !== chars[chars.length - 1]) {
                chars.push(next);
            }
        }

        let lastChar;
        do {
            lastChar = randomChar(upper);
        } while (lastChar === chars[chars.length - 1]);

        chars.push(lastChar);
        password = chars.join("");

    } while (!isValid(password));

    document.getElementById("result").textContent = password;
}

function copyPassword() {
    const text = document.getElementById("result").textContent;
    if (!text) return;
    navigator.clipboard.writeText(text);

    const icon = document.getElementById("copyIcon");
    icon.innerHTML = `<polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>`;

    setTimeout(() => {
        icon.innerHTML = `<path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2zm0 16H8V7h11v14z"/>`;
    }, 1500);
}

function toggleTheme() {
    document.body.classList.toggle("dark");
    updateIcon();
}

function updateIcon() {
    const icon = document.getElementById("themeIcon");
    if (document.body.classList.contains("dark")) {
        icon.innerHTML = `
            <path d="M21 12.79A9 9 0 0 1 11.21 3
            7 7 0 1 0 21 12.79z"/>
        `;
    } else {
        icon.innerHTML = `
            <circle cx="12" cy="12" r="5"/>
            <g>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </g>
        `;
        icon.querySelectorAll("line").forEach(l=>{
            l.setAttribute("stroke","currentColor");
            l.setAttribute("stroke-width","2");
        });
    }
}

updateIcon();
</script>

</body>
</html>
